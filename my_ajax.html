<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AJAX CRUD (json-server)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    body { padding: 24px; }
    .table td, .table th { vertical-align: middle; }
    .level-badge { min-width: 2.25rem; display:inline-block; text-align:center; }
  </style>
</head>
<body class="container">

  <h1 class="mb-4">ğŸ“š AJAX CRUD (my_ajax.html)</h1>

  <!-- Toolbar -->
  <div class="d-flex flex-wrap gap-2 mb-3">
    <input id="q" class="form-control" style="max-width:280px" placeholder="ê²€ìƒ‰(ë‹¨ì–´/ëœ»/ì‘ì„±ì)" />
    <button class="btn btn-outline-primary" id="btnSearch">ê²€ìƒ‰</button>
    <button class="btn btn-success ms-auto" data-bs-toggle="modal" data-bs-target="#addModal">ì¶”ê°€</button>
  </div>

  <!-- Table -->
  <div class="table-responsive">
    <table class="table table-hover table-striped align-middle">
      <thead class="table-light">
        <tr>
          <th style="width:60px">ID</th>
          <th>ë‹¨ì–´</th>
          <th>ëœ»</th>
          <th>ì‘ì„±ì</th>
          <th style="width:120px">ë‚ ì§œ</th>
          <th>ì¹´í…Œê³ ë¦¬</th>
          <th style="width:100px">ë‚œì´ë„</th>
          <th style="width:160px">ì•¡ì…˜</th>
        </tr>
      </thead>
      <tbody id="list"></tbody>
    </table>
  </div>

  <!-- Add Modal -->
  <div class="modal fade" id="addModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog"><div class="modal-content">
      <form id="addForm">
        <div class="modal-header">
          <h5 class="modal-title">ë°ì´í„° ì¶”ê°€</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
        </div>
        <div class="modal-body">
          <div class="mb-2">
            <label class="form-label">ë‹¨ì–´</label>
            <input class="form-control" name="word" required minlength="2">
          </div>
          <div class="mb-2">
            <label class="form-label">ëœ»</label>
            <input class="form-control" name="meaning" required minlength="2">
          </div>
          <div class="mb-2">
            <label class="form-label">ì‘ì„±ì</label>
            <input class="form-control" name="author" required minlength="1">
          </div>
          <div class="mb-2">
            <label class="form-label">ë‚ ì§œ</label>
            <input type="date" class="form-control" name="date" required>
          </div>
          <div class="mb-2">
            <label class="form-label">ì¹´í…Œê³ ë¦¬</label>
            <select class="form-select" name="category" required>
              <option value="">-- ì„ íƒ --</option>
              <option>ëª…ì‚¬</option><option>ë™ì‚¬</option><option>í˜•ìš©ì‚¬</option><option>ê¸°íƒ€</option>
            </select>
          </div>
          <div>
            <label class="form-label">ë‚œì´ë„ (1~5)</label>
            <input type="number" class="form-control" name="level" min="1" max="5" required>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">ì·¨ì†Œ</button>
          <button class="btn btn-success" type="submit">ì¶”ê°€</button>
        </div>
      </form>
    </div></div>
  </div>

  <!-- Edit Modal -->
  <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog"><div class="modal-content">
      <form id="editForm">
        <div class="modal-header">
          <h5 class="modal-title">ë°ì´í„° ìˆ˜ì •</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ë‹«ê¸°"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="id">
          <div class="mb-2">
            <label class="form-label">ë‹¨ì–´</label>
            <input class="form-control" name="word" required minlength="2">
          </div>
          <div class="mb-2">
            <label class="form-label">ëœ»</label>
            <input class="form-control" name="meaning" required minlength="2">
          </div>
          <div class="mb-2">
            <label class="form-label">ì‘ì„±ì</label>
            <input class="form-control" name="author" required minlength="1">
          </div>
          <div class="mb-2">
            <label class="form-label">ë‚ ì§œ</label>
            <input type="date" class="form-control" name="date" required>
          </div>
          <div class="mb-2">
            <label class="form-label">ì¹´í…Œê³ ë¦¬</label>
            <select class="form-select" name="category" required>
              <option value="">-- ì„ íƒ --</option>
              <option>ëª…ì‚¬</option><option>ë™ì‚¬</option><option>í˜•ìš©ì‚¬</option><option>ê¸°íƒ€</option>
            </select>
          </div>
          <div>
            <label class="form-label">ë‚œì´ë„ (1~5)</label>
            <input type="number" class="form-control" name="level" min="1" max="5" required>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal" type="button">ì·¨ì†Œ</button>
          <button class="btn btn-primary" type="submit">ì €ì¥</button>
        </div>
      </form>
    </div></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // ===== ì„¤ì • =====
    const API = 'http://localhost:3000/words';

    // ===== ê³µìš© í•¨ìˆ˜ =====
    async function http(url, opts = {}) {
      const res = await fetch(url, { headers: { 'Content-Type': 'application/json' }, ...opts });
      if (!res.ok) throw new Error(`${res.status} ${res.statusText}: ${await res.text()}`);
      return res.json();
    }
    const $ = sel => document.querySelector(sel);

    // ===== ëª©ë¡ =====
    async function loadList(query='') {
      const q = query ? `?q=${encodeURIComponent(query)}` : '';
      const rows = await http(`${API}${q}`);
      const tbody = $('#list');
      tbody.innerHTML = '';
      rows.forEach(row => {
        tbody.insertAdjacentHTML('beforeend', `
          <tr>
            <td>${row.id}</td>
            <td>${row.word}</td>
            <td>${row.meaning}</td>
            <td>${row.author}</td>
            <td>${row.date}</td>
            <td>${row.category}</td>
            <td><span class="badge text-bg-secondary level-badge">${row.level}</span></td>
            <td>
              <button class="btn btn-sm btn-warning me-1" onclick='openEdit(${row.id})'>ìˆ˜ì •</button>
              <button class="btn btn-sm btn-danger" onclick='removeItem(${row.id})'>ì‚­ì œ</button>
            </td>
          </tr>
        `);
      });
    }

    // ===== ì¶”ê°€ =====
    $('#addForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const fd = new FormData(e.target);
      const body = Object.fromEntries(fd.entries());
      body.level = Number(body.level);
      await fetch(API, { method: 'POST', body: JSON.stringify(body), headers: {'Content-Type':'application/json'} });
      bootstrap.Modal.getInstance($('#addModal')).hide();
      e.target.reset();
      await loadList($('#q').value.trim());
      alert('ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
    });

    // ===== ìˆ˜ì • ì—´ê¸° =====
    async function openEdit(id) {
      const data = await http(`${API}/${id}`);
      const f = $('#editForm');
      f.id.value       = data.id;
      f.word.value     = data.word;
      f.meaning.value  = data.meaning;
      f.author.value   = data.author;
      f.date.value     = data.date;
      f.category.value = data.category;
      f.level.value    = data.level;
      new bootstrap.Modal($('#editModal')).show();
    }

    // ===== ìˆ˜ì • ì €ì¥ =====
    $('#editForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const fd = new FormData(e.target);
      const id = fd.get('id');
      const body = Object.fromEntries(fd.entries());
      body.level = Number(body.level);
      delete body.id;
      await fetch(`${API}/${id}`, { method: 'PUT', body: JSON.stringify(body), headers: {'Content-Type':'application/json'} });
      bootstrap.Modal.getInstance($('#editModal')).hide();
      await loadList($('#q').value.trim());
      alert('ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
    });

    // ===== ì‚­ì œ =====
    async function removeItem(id) {
      if (!confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”?')) return;
      await fetch(`${API}/${id}`, { method: 'DELETE' });
      await loadList($('#q').value.trim());
      alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    // ===== ê²€ìƒ‰ ë²„íŠ¼ =====
    $('#btnSearch').addEventListener('click', () => loadList($('#q').value.trim()));
    $('#q').addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ loadList($('#q').value.trim()); }});

    // ì´ˆê¸° ë¡œë“œ
    loadList();
  </script>
</body>
</html>
